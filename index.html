<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Will You Be My Valentine?</title>
  <style>
    :root {
      --bg-color: #fff0f5;
      --text-color: #4a4a4a;
      --accent-color: #ff4757;
      --yes-btn-bg: #4CAF50;
      --no-btn-bg: #f44336;
      --success-color: #d90429;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background-color: var(--bg-color);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 1rem;
      overflow: hidden;
      position: relative;
    }

    /* Loading Spinner */
    #preloader {
      position: fixed; inset: 0; background-color: var(--bg-color);
      z-index: 999; display: flex; justify-content: center; align-items: center;
      transition: opacity 0.5s ease-out;
    }
    .loader {
      width: 60px; height: 60px;
      border: 6px solid rgba(217, 4, 41, 0.2);
      border-top-color: var(--success-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Containers */
    main, section { 
        z-index: 10; text-align: center; 
        max-width: 90%; width: 500px; 
    }
    
    #welcome-screen { display: none; } /* Shown after preloader */
    #main-container { display: none; } /* Shown after name entry */
    #success-container { display: none; animation: fadeInUp 0.8s ease-out; }

    /* Typography */
    h1 {
      font-size: clamp(1.8rem, 6vw, 2.8rem);
      margin-bottom: 0.5rem; color: var(--text-color);
      line-height: 1.2;
    }
    
    p.subtitle {
        font-size: 1.1rem;
        color: #777;
        margin-bottom: 2rem;
    }

    /* Welcome Screen Card */
    .welcome-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        padding: 2.5rem;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        border: 1px solid rgba(255, 255, 255, 0.5);
    }

    /* Images */
    .main-img {
      width: clamp(200px, 60vw, 280px);
      height: auto; margin-bottom: 2rem;
      user-select: none; -webkit-user-drag: none;
    }

    /* Inputs */
    .input-group { margin-bottom: 1.5rem; }
    
    input[type="text"] {
        padding: 15px 20px;
        font-size: 1.1rem;
        border: 2px solid #ffccd5;
        border-radius: 12px;
        outline: none;
        width: 100%;
        max-width: 300px;
        text-align: center;
        background: #fff;
        color: #333;
        transition: border-color 0.3s, box-shadow 0.3s;
    }
    input[type="text"]:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 15px rgba(255, 71, 87, 0.1);
    }

    /* Buttons */
    .continue-btn {
        background-color: var(--accent-color);
        color: white;
        padding: 15px 40px;
        font-size: 1.1rem;
        font-weight: 600;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        transition: transform 0.2s, background-color 0.2s;
    }
    .continue-btn:hover { 
        transform: translateY(-2px); 
        background-color: #ff2e43;
    }

    .buttons { 
        display: flex; justify-content: center; gap: 15px; 
        flex-wrap: wrap; 
    }

    .btn {
      padding: 12px 24px; font-size: 1.1rem; font-weight: 600;
      border: none; border-radius: 25px; color: #fff; cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      min-width: 100px;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active { transform: scale(0.95); }
    
    #yes-btn { 
        background-color: var(--yes-btn-bg); 
        z-index: 20; 
        transition: transform 0.3s ease;
    }
    #no-btn { background-color: var(--no-btn-bg); position: relative; }

    /* Success Stickers */
    #success-container h1 { color: var(--success-color); }
    .sticker-container { position: relative; height: 300px; margin-top: 2rem; }
    .sticker-container img {
      width: clamp(250px, 80vw, 350px); 
      position: absolute; left: 50%;
      transform: translateX(-50%); transition: opacity 0.5s ease-in-out;
    }

    /* Toast Notification */
    #toast {
        visibility: hidden; min-width: 250px; background-color: #333;
        color: #fff; text-align: center; border-radius: 8px; padding: 16px;
        position: fixed; z-index: 100; left: 50%; bottom: 30px;
        transform: translateX(-50%); font-size: 1rem;
        opacity: 0; transition: opacity 0.5s, bottom 0.5s;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    #toast.show { visibility: visible; opacity: 1; bottom: 50px; }

    /* Floating Hearts */
    .hearts {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; overflow: hidden; z-index: 1;
    }
    .heart {
        position: absolute; width: 20px; height: 20px;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff8fab"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>');
        background-size: contain; bottom: -20px;
        animation: fly 10s linear infinite; opacity: 0;
    }
    @keyframes fly {
        0% { transform: translateY(0) rotate(0deg); opacity: 1; }
        100% { transform: translateY(-120vh) rotate(720deg); opacity: 0; }
    }
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px) scale(0.95); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }
  </style>
</head>
<body>
  <div id="preloader"><div class="loader"></div></div>
  <div class="hearts"></div>
  
  <audio id="bg-music" src="media/audio/song.mp3" preload="auto" loop></audio>

  <section id="welcome-screen">
      <div class="welcome-card">
          <h1>Hello there! ðŸ’•</h1>
          <p class="subtitle">Before we begin, what is your name?</p>
          <div class="input-group">
              <input type="text" id="visitor-name" placeholder="Enter your name" autocomplete="off" />
          </div>
          <button class="continue-btn" id="continue-btn">Continue</button>
      </div>
  </section>

  <main id="main-container">
    <h1>Will you be my Valentine? ðŸ’Œ</h1>
    <img class="main-img" src="media/gifs/main.gif" alt="Please?" />
    <div class="buttons">
      <button class="btn" id="yes-btn">Yes</button>
      <button class="btn" id="no-btn">No</button>
    </div>
  </main>

  <section id="success-container">
    <h1>Knew youâ€™d say yes! ðŸ¥°</h1>
    <div class="sticker-container">
        <img id="intermediate-sticker" src="media/gifs/sticker1.gif" alt="Yay!" />
        <img id="final-sticker" src="media/gifs/final.gif" alt="Hugging" style="opacity: 0;" />
    </div>
  </section>

  <div id="toast">Asif has been notified! ðŸ’•</div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Elements
      const preloader = document.getElementById('preloader');
      const welcomeScreen = document.getElementById('welcome-screen');
      const mainContainer = document.getElementById('main-container');
      const successContainer = document.getElementById('success-container');
      
      const nameInput = document.getElementById('visitor-name');
      const continueBtn = document.getElementById('continue-btn');
      
      const noBtn = document.getElementById('no-btn');
      const yesBtn = document.getElementById('yes-btn');
      const music = document.getElementById('bg-music');
      const heartsContainer = document.querySelector('.hearts');
      const toast = document.getElementById('toast');

      let visitorName = "Anonymous"; 

      // --- 1. Preload Images ---
      const imagesToPreload = ["media/gifs/sticker2.gif", "media/gifs/sticker3.gif", "media/gifs/final.gif"];
      imagesToPreload.forEach(src => {
          const img = new Image();
          img.src = src;
      });

      // --- 2. Initial Load ---
      window.addEventListener('load', () => {
        preloader.style.opacity = '0';
        setTimeout(() => {
            preloader.style.display = 'none';
            // Show Welcome Screen
            welcomeScreen.style.display = 'block';
            welcomeScreen.style.animation = 'fadeInUp 0.8s ease-out';
        }, 500);
      });

      // --- 3. Welcome Logic (Captures Name & Starts Music) ---
      continueBtn.addEventListener('click', () => {
          const val = nameInput.value.trim();
          
          if (!val) {
              alert("Please enter your name to continue! ðŸ’•");
              return;
          }
          
          visitorName = val; 
          
          // Play Music immediately on interaction
          music.play().catch(e => console.log("Audio error:", e));
          
          // Smooth Transition
          welcomeScreen.style.animation = 'fadeOut 0.5s forwards';
          setTimeout(() => {
              welcomeScreen.style.display = 'none';
              mainContainer.style.display = 'block';
              mainContainer.style.animation = 'fadeInUp 0.8s ease-out';
          }, 500);
      });

      // --- 4. Background Hearts ---
      function createHeart() {
          const heart = document.createElement('div');
          heart.classList.add('heart');
          heart.style.left = Math.random() * 100 + "vw";
          heart.style.animationDuration = Math.random() * 5 + 5 + "s";
          heartsContainer.appendChild(heart);
          setTimeout(() => heart.remove(), 10000);
      }
      setInterval(createHeart, 300);

      // --- 5. Toast Helper ---
      function showToast() {
        toast.className = "show";
        setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
      }

      // --- 6. "No" Button Logic ---
      const noPhrases = [
        "Are you sure?", "Really sure?", "Think again!", "Last chance!", 
        "Surely not?", "You might regret this!", "Give it another thought!", 
        "Are you absolutely certain?", "This could be a mistake!", 
        "Have a heart!", "Don't be so cold!", "Change of heart?", 
        "Wouldn't you reconsider?", "Is that your final answer?", 
        "You're breaking my heart ;("
      ];
      let phraseIndex = 0;
      
      noBtn.addEventListener('click', () => {
         noBtn.innerText = noPhrases[phraseIndex % noPhrases.length];
         phraseIndex++;
         moveNoButton();
         const currentScale = parseFloat(yesBtn.style.transform.replace('scale(', '')) || 1;
         yesBtn.style.transform = `scale(${currentScale + 0.5})`;
      });

      function moveNoButton() {
        const padding = 20;
        const btnWidth = noBtn.offsetWidth;
        const btnHeight = noBtn.offsetHeight;
        const maxX = window.innerWidth - btnWidth - padding;
        const maxY = window.innerHeight - btnHeight - padding;
        const x = Math.max(padding, Math.random() * maxX);
        const y = Math.max(padding, Math.random() * maxY);
        noBtn.style.position = 'fixed'; 
        noBtn.style.left = `${x}px`; 
        noBtn.style.top = `${y}px`;
        noBtn.style.zIndex = '100'; 
      }

      // --- 7. "Yes" Button Logic (Sends Name) ---
      yesBtn.addEventListener('click', async () => {
        // Use the captured name in the message
        const message = `${visitorName} said YES! â¤ï¸`;

        fetch('/api/send-love', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ content: message }) 
        })
        .then(res => {
            if(res.ok) showToast();
        })
        .catch(e => console.error("Error:", e));

        // Start Animation
        mainContainer.style.display = 'none';
        successContainer.style.display = 'block';
        
        const intermediateSticker = document.getElementById('intermediate-sticker');
        const finalSticker = document.getElementById('final-sticker');
        
        const sequence = ["media/gifs/sticker1.gif", "media/gifs/sticker2.gif", "media/gifs/sticker3.gif"];
        
        for (const src of sequence) {
            intermediateSticker.src = src;
            await new Promise(r => setTimeout(r, 1500));
        }
        
        intermediateSticker.style.opacity = '0';
        finalSticker.style.opacity = '1';
      });
    });
  </script>
</body>
</html>
